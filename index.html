<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>گاوصندوق</title>
<style>
  body{
    margin:0; height:100vh; display:flex; justify-content:center; align-items:center;
    background:#111;
    font-family:"Vazirmatn",sans-serif;
    color:#fff;
  }
  .safe{
    position:relative;
    width:400px;
  }
  .safe img{
    width:100%;
    display:block;
  }

  .hotspot{
    position:absolute;
    top:56%;
    left:50%;
    transform:translate(-50%,-50%);
    width:120px; height:120px;
    border-radius:50%;
    cursor:pointer;
    display:flex; align-items:center; justify-content:center;
  }
  .hotspot::after{
    content:"?";
    font-size:36px;
    color:#fff;
    text-shadow:0 0 8px rgba(0,0,0,0.7);
  }

  .overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.85);
    display:none;
    justify-content:center;
    align-items:center;
  }
  .overlay.show{ display:flex; }
  .panel{
    background:#222; padding:20px; border-radius:10px; text-align:center;
    width:260px;
    box-shadow:0 0 20px rgba(0,0,0,.6);
    transition:transform 0.2s;
  }
  .panel h3{margin:0 0 15px;}
  .dots{
    display:flex; gap:10px; justify-content:center; margin:15px 0;
  }
  .dot{
    width:14px; height:14px; border-radius:50%; background:#555;
  }
  .dot.filled{ background:lime; }
  .keys{
    display:grid; grid-template-columns:repeat(3,1fr); gap:10px;
  }
  .key{
    background:#444; border:none; border-radius:8px; color:#fff; font-size:18px;
    padding:15px; cursor:pointer;
  }
  .key:hover{ background:#666; }
  .message{
    margin-top:15px;
    font-weight:bold;
    color:#9f9;
    display:none;
  }
  #close{
    margin-top:15px;
    background:#900;
    padding:8px 12px;
    border:none;
    border-radius:6px;
    color:#fff;
    cursor:pointer;
  }

  /* انیمیشن لرزش */
  .shake {
    animation: shake 0.3s;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
  }
</style>
</head>
<body>
  <div class="safe">
    <img src="safe.jpg" alt="گاوصندوق">
    <div class="hotspot" id="hotspot"></div>
  </div>

  <div class="overlay" id="overlay">
    <div class="panel" id="panel">
      <h3>رمز ۴ رقمی را وارد کنید</h3>
      <div class="dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div class="keys">
        <button class="key" data-k="1">1</button>
        <button class="key" data-k="2">2</button>
        <button class="key" data-k="3">3</button>
        <button class="key" data-k="4">4</button>
        <button class="key" data-k="5">5</button>
        <button class="key" data-k="6">6</button>
        <button class="key" data-k="7">7</button>
        <button class="key" data-k="8">8</button>
        <button class="key" data-k="9">9</button>
        <div></div>
        <button class="key" data-k="0">0</button>
        <button class="key" id="clear">⌫</button>
      </div>
      <div class="message" id="msg">پاکتی داخل گاوصندوق هست، رو باز کنید ✅</div>
      <button id="close">بستن</button>
    </div>
  </div>

<script>
const CORRECT = "1357";
let input = "";
const overlay = document.getElementById("overlay");
const hotspot = document.getElementById("hotspot");
const dots = document.querySelectorAll(".dot");
const msg = document.getElementById("msg");
const panel = document.getElementById("panel");

let activated = false; // پرچم برای فعال‌سازی با کلیک

function render(){
  dots.forEach((d,i)=> d.classList.toggle("filled", i<input.length));
}
function reset(){ 
  input=""; 
  render(); 
  msg.style.display="none"; 
}
function check(){
  if(input===CORRECT){
    msg.style.display="block";
  } else {
    panel.classList.add("shake");
    setTimeout(()=> panel.classList.remove("shake"), 300);
    input=""; render();
  }
}

// کلیک → فعال‌سازی
hotspot.addEventListener("click", ()=>{
  activated = true;
});

// هاور فقط وقتی کلیک شده
hotspot.addEventListener("mouseenter", ()=>{
  if(activated){
    overlay.classList.add("show");
    reset();
  }
});

// بستن با کلیک بیرون
overlay.addEventListener("click",(e)=>{
  if(e.target===overlay){ 
    overlay.classList.remove("show"); 
    activated = false; // دوباره غیرفعال میشه
  }
});

// بستن با دکمه
document.getElementById("close").addEventListener("click",()=>{
  overlay.classList.remove("show");
  activated = false;
});

// صفحه کلید
document.querySelectorAll(".key").forEach(k=>{
  k.addEventListener("click",()=>{
    if(k.id==="clear"){ input=input.slice(0,-1); render(); return; }
    if(input.length>=4) return;
    input += k.dataset.k;
    render();
    if(input.length===4){ check(); }
  });
});
</script>
</body>
</html>
